{% extends "base.html" %}

{% block content %}

<style>
    .section-wrapper {
        margin-bottom: 3rem;
    }

    .styled-form {
        background: #ffffff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
        border: 1px solid #edf2f7;
    }

    .card-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .card-header h2 {
        margin: 0;
        font-size: 1.6rem;
        color: #2d3748;
    }

    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 2rem;
        align-items: center;
    }

    .filter-bar label {
        font-weight: 600;
        color: #4a5568;
    }

    .filter-bar select,
    select,
    input[type="text"],
    textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #cbd5e0;
        border-radius: 8px;
        font-size: 1rem;
        box-sizing: border-box;
    }

    .filter-bar select {
        min-width: 240px;
        max-width: 320px;
    }

    textarea {
        resize: vertical;
        min-height: 80px;
    }

    .form-group-label {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 0.35rem;
        margin-top: 1rem;
    }

    .form-group-label:first-child {
        margin-top: 0;
    }

    button {
        padding: 0.6rem 1.2rem;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        border: none;
    }

    button[type="submit"] {
        background-color: #4299e1;
        color: #fff;
    }

    button[type="submit"]:hover {
        background-color: #3182ce;
    }

    .danger {
        background-color: #fff5f5;
        color: #c53030;
        border: 1px solid #feb2b2;
    }

    .danger:hover {
        background-color: #fed7d7;
    }

    .candidates-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 1.5rem;
    }

    .candidates-table thead {
        display: none;
    }

    .candidates-table td {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .edit-form-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .row-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-top: 0.5rem;
    }

    .campaign-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        background: #edf2f7;
        border-radius: 999px;
        padding: 0.25rem 0.8rem;
        font-size: 0.85rem;
        color: #4a5568;
        font-weight: 600;
    }

    .empty-state {
        text-align: center;
        padding: 3rem;
        background: #f7fafc;
        border-radius: 12px;
        color: #718096;
        border: 2px dashed #cbd5e0;
    }
</style>

<div class="filter-bar">
    <label for="campaign-filter">Campaign</label>
    <form method="get" style="display: contents;">
        <select id="campaign-filter" name="campaign_id" onchange="this.form.submit()">
            {% for campaign in campaigns %}
                <option value="{{ campaign.id }}" {% if campaign.id == selected_campaign_id %}selected{% endif %}>
                    {{ campaign.name }} {% if not campaign.is_active %}(Paused){% endif %}
                </option>
            {% endfor %}
        </select>
    </form>
</div>

<section class="section-wrapper">
    <div class="styled-form">
        <div class="card-header">
            <h2>Add New Candidate</h2>
            <p style="color:#718096;margin-top:0.5rem;">Register contenders inside the selected campaign.</p>
        </div>
        <form method="post">
            <input type="hidden" name="action" value="create">

            <label class="form-group-label">Candidate Name</label>
            <input type="text" name="name" required placeholder="e.g. Jane Doe">

            <label class="form-group-label">Manifesto / Slogan</label>
            <textarea name="manifesto" rows="3" placeholder="Enter their campaign promise or bio..."></textarea>

            <label class="form-group-label">Assign to Campaign</label>
            <select name="campaign_id" required>
                {% for campaign in campaigns %}
                    <option value="{{ campaign.id }}" {% if campaign.id == selected_campaign_id %}selected{% endif %}>
                        {{ campaign.name }} {% if not campaign.is_active %}(Paused){% endif %}
                    </option>
                {% endfor %}
            </select>

            <div style="margin-top:1.5rem;">
                <button type="submit" style="width:100%;padding:0.8rem;">+ Create Candidate</button>
            </div>
        </form>
    </div>
</section>

<section class="section-wrapper">
    <h2 style="font-size:1.5rem;color:#2d3748;margin-bottom:1rem;">Existing Candidates</h2>

    {% if candidates %}
        <table class="candidates-table">
            <tbody>
                {% for candidate in candidates %}
                    <tr>
                        <td>
                            <form method="post" class="edit-form-grid">
                                <input type="hidden" name="action" value="update">
                                <input type="hidden" name="candidate_id" value="{{ candidate.id }}">

                                <div>
                                    <label class="form-group-label">Name</label>
                                    <input type="text" name="name" value="{{ candidate.name }}" required>
                                </div>

                                <div>
                                    <label class="form-group-label">Manifesto</label>
                                    <textarea name="manifesto" rows="3">{{ candidate.manifesto }}</textarea>
                                </div>

                                <div>
                                    <label class="form-group-label">Campaign</label>
                                    <select name="campaign_id" required>
                                        {% for campaign in campaigns %}
                                            <option value="{{ campaign.id }}" {% if campaign.id == candidate.campaign_id %}selected{% endif %}>
                                                {{ campaign.name }} {% if not campaign.is_active %}(Paused){% endif %}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="row-actions">
                                    <span class="campaign-pill"> {{ candidate.campaign.name }} </span>
                                    <button type="submit">Save Changes</button>
                                    <button class="danger" name="action" value="delete" onclick="return confirm('Delete {{ candidate.name }}? This cannot be undone.');">
                                        Delete
                                    </button>
                                </div>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <p>No candidates for this campaign yet.</p>
            <small>Use the form above to add the first candidate.</small>
        </div>
    {% endif %}
</section>

{% endblock %}